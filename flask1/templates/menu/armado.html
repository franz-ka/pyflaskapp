{% extends '_appgui.html' %}
{% block content %}
<style>
    .select2-selection__rendered {
        line-height: 33px !important;
    }
    .select2-container .select2-selection--single {
        height: 37px !important;
    }
    .select2-selection__arrow {
        height: 34px !important;
    }
</style>

<div class="card card-body bg-light">
    <h3 class="card-header">Impresiones hechas</h3>
    <div class="card-block">
        <table class="table table-sm table-striped table-hover">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Pieza</th>
              <th>Cantidad</th>
            </tr>
          </thead>
          <tbody>
            {% for imppiez in imppiezs %}
                <tr>
                    <td scope="row">{{imppiez.impresion.fecha.strftime("%d/%m/%Y %H:%M")}}</td>
                    <td>{{imppiez.pieza.nombre}}</td>
                    <td>{{imppiez.cantidad}}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>

<div class="card card-body bg-light">
    <h3 class="card-header">Registrar impresi√≥n</h3>
    <div class="card-block">
    </div>
</div>

<script type="text/javascript">
$(function() {
    $('input[name=fecha]').val("{{nowfecha}}");
    $('input[name=hora]').val("{{nowtiempo}}");
    piezasdata = [
        {% for piez in piezs %}
            {
                "id": {{piez.id}},
                "text": "{{piez.nombre}}"
            }
            {% if not loop.last %},{% endif %}
        {% endfor %}
    ]

    $('.select2-single').select2({
        allowClear: true,
        placeholder: 'Pieza',
        width: '100%',
        data: piezasdata
    });

    // html5 constraints - https://www.w3.org/TR/html5/sec-forms.html#constraints
    // bs4 form validation - https://getbootstrap.com/docs/4.0/components/forms/#validation
    var formvalidtout;
    var forms = document.forms;
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
        if (formvalidtout)
            clearTimeout(formvalidtout);
        formvalidtout = setTimeout( function(){ form.classList.remove('was-validated'); } , 3000 );
      }, false);
    });
});
</script>
{% endblock %}