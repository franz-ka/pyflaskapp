{% extends '_maingui.html' %}

{% block content %}
{% call forms.card('Stock de pikas')  %}
<table class="table table-sm table-striped table-hover">
  <thead>
    <tr>
      <th>Pika</th>
      <th>Prestock</th>
      <th>Stock</th>
      <th>Actualizado</th>
    </tr>
  </thead>
  <tbody>
    {% for pika_spika_pspika in DATA %}
		{% set css_class = '' %}
		{% set pika_id = pika_spika_pspika[0].id %}
		{% set prestock = pika_spika_pspika[1].cantidad %}
		{% set stock = pika_spika_pspika[2].cantidad %}
		{% set stock_total = prestock + stock %}
		
		{% if pika_id in pikascolores %}
			{% if pikascolores[pika_id][0] and stock_total <= pikascolores[pika_id][0] %}
				{% set css_class = 'table-danger' %}
			{% elif pikascolores[pika_id][1] and stock_total <= pikascolores[pika_id][1] %}
				{% set css_class = 'table-warning' %}
    		{% endif %}
    	{% endif %}

        <tr class="{{css_class}}">
            <td>{{pika_spika_pspika[0].nombre}}</td>
            <td>{{prestock}}</td>
            <td>{{stock}}</td>
            <td scope="row">
				{% set fecha_mayor = pika_spika_pspika[1].fecha if pika_spika_pspika[1].fecha > pika_spika_pspika[2].fecha else pika_spika_pspika[2].fecha %}
				{{fecha_mayor.strftime("%d/%m/%Y %H:%M")}}
			</td>
        </tr>
    {% endfor %}
</table>
<a class="btn btn-primary btn-block" href="{{url_for('pikas.exportar_stockpikas')}}">Exportar a CSV</a>
{% endcall %}
{% endblock %}

{% block js %}
<script type="text/javascript">
$(function() {
    
});
</script>
{% endblock %}
